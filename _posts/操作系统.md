---
title: 操作系统
date: 2018-10-06 16:07:40
categories:
- 操作系统
tags:
- 操作系统
---


### 一、操作系统

#### 1 定义

用以控制和管理系统资源，方便用户使用计算机的程序集合

#### 2 设计目标
- 方便用户使用
- 扩大机器功能
- 提高系统效率
- 构筑开放环境


#### 3 操作系统的功能
- 处理机管理（CPU的管理）
- 存储器管理（三种存储结构）
- 设备管理
- 信息管理
<!-- more -->
##### 处理机管理

- 将系统中的各台处理机分给要求的用户作业使用。
- 处理机管理的要点是调度策略和调度算法。


###### 存储器管理
- 按一定策略将主存空间分配给各作业
- 记录存储器的使用情况，防止存贮破坏或损坏

#### 4.操作系统的性能指标

系统的可靠性

- 系统能发现、诊断和恢复硬件、软件故障的能力。

系统吞吐率

- 系统在单位时间内所处理的信息量

系统响应时间
- 从系统接收数据到输出结果的时间间隔

系统资源利用率

- 系统中各部件、各种设备的使用程度

可移植性
- 操作系统从一个硬件环境转移到另一个硬件环境仍能 正常工作的能力

### 二、Process Management

#### 1.Carousel Management Model

- Interruption Managerment Ability
- Privilege Level
- Process Control and Process Management 

#### 2.Interruption

- Interruption is an important part of OS.
- OS is drived by  Interruption 
- Interruption is the response of CPU to OS. 


#### 3.Interruption types

- Complusive Interruption 
```
输入/输出(I/O)中断:主要来自外部设备通道(自旋锁)
程序性中断:运行程序中本身的中断
(如溢出，缺页中断，缺段中断，地址越界) 
时钟中断(difficult to time in OS)
控制台中断
硬件故障
```
- Voluntary Interruption

```
execute I/O, create process, allocate memory
 
send/receive Messages Semaphore operation
```

### 4.Privilege control system

- Privilege levels
```
ring0 ~ ring3
```
- Privileged instruction and privilege registers 


### 5.Process Control and Process Management 

- Process 
```
进程是具有独立功能的程序关于某个数据集合上的一次运行活动，是系统进行资源分配和调度的独立单位
```
- The difference between process and program

```
动态与静态的差异
进程包括程序与数据
一个程序可以对应多个进程 
一个进程可以涉及多个程序
```
- 进程的性质
```
结构性:包括数据集合和运行于其上的程序

共享性:同一程序同时运行于不同数据集合上时，构成不同的进程

动态性:进程是程序在数据集合上的一次执行过 程，是动态概念;而程序是一组有序指令序列， 是静态概念

独立性:是系统中资源分配和保护的基本单位，也是系统调度的独立单位(单线程进程)

制约性:并发进程之间存在着制约性，在进行的 关键点上需要相互等待或互通消息

并发性:进程可以并发地执行
```
- 进程的状态
```
运行态(Running)
 进程占有CPU，并在CPU上运行
就绪态(Ready)
 一个进程已经具备运行条件，但由于无CPU暂时不能运行的状态(当调度给其CPU时，立即可以运行)  
等待态(Blocked)
 指进程因等待某种事件的发生而暂时不能运行的状态 (即使CPU空闲，该进程也不可运行
```
- 进程的描述
```
进程程序块：标识信息（PID，PPID，user）、状态信息（用户使用的寄存器、控制和状态的寄存器--程序计数器和条件寄存器、堆栈指针）、控制信息
（空闲链，占用链）

进程数据块

系统、用户堆栈

进程控制块
```
- 进程控制信息

1.调度和状态信息；

2.进程在有关队列中的链接指针；

3.进程间的通信信息（标志位、信号和信号量、消息队列等）；

4.主存使用信息；

5.进程得到有关服务的优先级。

- 进程控制

创建、撤消进程以及完成进程各状态之间的转换。 由具有特定功能的原语完成。

- 创建进程

1.创建PCB；

2.赋予一个统一进程标识符

3.为进程映象分配空间

4.初始化进程控制块

5.许多默认值 (如: 状态为 New，无I/O设备或文 件...)

6.设置相应的链接

- 进程切换

1.保存被中断进程的处理器现场信息

2.修改被中断进程的进程控制块的有关信息，如
进程状态等

3.把被中断进程的PCB加入有关队列

4.选择下一个占有处理器运行的进程

5.修改被选中进程的PCB的有关信息

6.根据被选中进程设置操作系统用到的地址转换 和存储保护信息

7.根据被选中进程恢复处理器现场

- 撤销进程

1.根据撤销进程标识号，从相应队列中找到它的 PCB

2.将该进程拥有的资源归还给父进程或操作系统

3.若该进程拥有子进程，应先撤销它的所有子孙
进程，以防它们脱离控制

4.被撤销进程出队，将它的PCB归还到PCB池

 ## 三、线程、并发、通信问题
 
 ### 1 进程
 
 - 进程的优点
 ```
 将程序和运行时的数据合集进行统一管理
 
 为操作系统管理多用户、多任务环境提供了基础
 ```

- 进程的不足
```
各进程的相对独立性为数据共享带来的限制

进程不能很好的利用多处理器资源--单个进程只能在一个处理器上运行
```

### 2 线程 
- 定义
```
进程中的一条执行路径，是系统进行处理器调度的基 本单位，同一个进程中的所有线程共享进程获得的主 存空间和资源
```
- 线程独立拥有的资源

- 特点
```
并行性: 同一进程的多个线程可在一个或多个处理器上并发运行

共享性: 一个进程下的线程共享进程获得的主存空间和一切资源

动态性：线程也是程序在相应数据集上的一次执行，由创建而产生， 至撤销而消亡，有其生命周期
```
- 线程的优点
```
创建一个新线程花费时间少(结束亦如此)

两个线程的切换花费时间少(不同的线程需要切换内核)

因为同一进程内的线程共享内存和文件，因此它们之
间相互通信无须调用内核

适合多处理机系统
```

- 线程的实现
```
内核级线程（一对一）

用户级线程（用线程库来实现调用，一个进程管理所有线程）

混合式线程（多对多）
```

### 3.同步和互斥

- 临界段
```
进程中访问共享变量的代码段
```
- 临界资源
```
允许多个进程共享使用的资源
```
- 临界段设计原则
```
每次允许一个进程停留在临界段
进程只能在临界段内逗留有限时间
进程不能在无限期等待在临界段之外
临界段外进程不可以阻止其他进程进入临界段
不能预期和假定进程进展的相对速度以及可用的处理
器的数目
```
- 临界段的实现
```
软件方法：复杂，局限性大

硬件方法：简单实用，使用广泛
```

- 硬件指令法
```
用公共变量标识是否占用临界资源
用一条不可打断的指令完成对公共变量的测试和修改
```
- PV操作

```
P(S)操作——将信号量S减1
V(S)操作——将信号量S加1

互斥——售票系统
同步——生产者消费者问题
```

- 当前操作系统当中的同步互斥手段
```
信号量

读写锁
```
- 其他的同步互斥概念
```
spinlock(自旋锁)--只g有多CPU才会用到
```

### 4.存储器的管理

- 存储器管理的目的
```
尽可能的充分利用存储器资源

尽可能满足作业进程对存储器的需求
```

- 对抗目标——内存碎片
- 存储器分配方案

```
1.固定分区方案

2.可变分区方案

3.虚拟存储方案
```
- 固定/可变分区方案的问题

```
内存分区是唯一的,

无法实现数据共享
```

- 虚拟存储方案

分页管理(可以申请可变分区，定buffer一般都是4k的整数倍，由操作系统当中的页面映像表标识页面与实际地址的 转换关系);

分段管理--作业进程根据存储对象不同在不同的段内存储，缺页中断;

段页式管理;

- 实现的核心

处理机管理-- 作业调度，作业共享、同步、互斥

存储器管理-- 充分利用存储器，尽可能满足进程要求
