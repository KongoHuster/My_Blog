---
title: Install CentOS
date: 2018-10-06 16:07:40
categories:
- Linux学习
tags:
- Linux
---

## 1 Set network
(1)cat /etc/sysconfig/network-scripts/ifcfg-enp2s0
```
root@centos1 ~]# cat /etc/sysconfig/network-scripts/ifcfg-enp2s0
HWADDR=00:E0:69:01:6A:96
TYPE=Ethernet
BOOTPROTO=dhcp
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
NAME=enp2s0
UUID=5b0a7d76-1602-4e19-aee6-29f57618ca01
ONBOOT=no
```
<!-- more -->
You should set the last ONBOOT=no to yes

(2)Restart centos
```
sudo shutdown -r 
```
(3)download something to try whether the network is ok
```
sudo yum isntall vim
```

## 2 Install your favorite desktop like GNOME

(1)Download GNOME
```
yum groupinstall "GNOME Desktop"
```
(2)Get which state that you start with
```
systemctl get-default
```
Generally you will get 
```
multi-user.target
```
(3)Start GNOME
```
systemctl set-default graphical.target
```
(4)And then you should restart your centos,enjoy the Gnome.
```
sudo shutdown -r
```
(5)If you want go back to the txt terminal before.Just try
```
systemctl set-default multi-user.target
```
(6) Also, you maybe want to use the text window
,just try
```
vi /etc/inittab
```
change 
```
:id:5:initdefault
```
to
```
:id:3:initdefault:
```

## 3 Use mac's ssh connect Linux

(1) Get your Linux ip in your Linux 
```
ifcofig
```
You will get 
```
[yzh@localhost ~]$ ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.90.130  netmask 255.255.255.0  broadcast 192.168.90.255
        inet6 fe80::8ff7:340:b11b:8aac  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:b4:9a:6e  txqueuelen 1000  (Ethernet)
        RX packets 78974  bytes 108181266 (103.1 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 33157  bytes 2240749 (2.1 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 72  bytes 6264 (6.1 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 72  bytes 6264 (6.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

virbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:96:e8:1e  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)

```
Your ip is 192.168.90.130

(2) Using ssh to connect Linux
```
ssh root@192.168.90.130
```
And input your password

## 4 Start your ssh 
(1) Checkout your ssh 
```
/etc/init.d/sshd status
```
(2) If it is not running, just restart it
```
/etc/init.d/sshd restart
```
## 5 Using zsh and change the shell which is my favorite shell

(1) Download zsh
```
sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
```

(2) Change the theme 

```
vi ~/.zshrc
```

```
ZSH_THEME="agnoster" # (this is one of the fancy ones)
```
## 6 Check the init config 
(1)Show the contents of an initramfs image
```
lsinitrd
```
(2)Copy and Unzip the image file 
```
cp initramfs-2.6.32-696.el6.x86_64.img /home/yzh/Documents
cd /home/yzh/Documents
ls
file initramfs-2.6.32-696.el6.x86_64.img
file --help
mv initramfs-2.6.32-696.el6.x86_64.img initramfs-2.6.32-696.el6.x86_64.img.gz
(this step is to change the file name)
ls
file initramfs-2.6.32-696.el6.x86_64.img.gz
tar -zxvf initramfs-2.6.32-696.el6.x86_64.img.gz
gzip -d initramfs-2.6.32-696.el6.x86_64.img.gz
```
and you  should recover the image file 
```
cpio -i < initramfs-3.10.0-229.el7.x86_64.img 
```

## 7 Format U disk
(1)Check your U disk is umounted 
```
fdisk -l
```
(2) Enter U disk and new a partition
```
fdisk /dev/sda
```
```
n
```
(3) Format your disk 
```
mkfs.ext4 /dev/sdb
```
## 8 Make your Linux system start with a shell

(1)Add a port for new initrd.img
```
cd /boot/grub

vi grub.conf
```
like this
```
# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this file
# NOTICE:  You have a /boot partition.  This means that
#          all kernel and initrd paths are relative to /boot/, eg.
#          root (hd0,0)
#          kernel /vmlinuz-version ro root=/dev/mapper/vg_yzh-lv_root
#          initrd /initrd-[generic-]version.img
#boot=/dev/sda
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title CentOS Linux 6 (2.6.32-696.el6.x86_64)
	root (hd0,0)
	kernel /vmlinuz-2.6.32-696.el6.x86_64 ro root=/dev/mapper/vg_yzh-lv_root rd_LVM_LV=vg_yzh/lv_swap rd_NO_LUKS LANG=en_US.UTF-8 rd_LVM_LV=vg_yzh/lv_root rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=128M  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet
	initrd /initramfs-2.6.32-696.el6.x86_64.img
title my_litile_linux
        root (hd0,0)
        kernel /vmlinuz-2.6.32-696.el6.x86_64
        initrd /Test.img
```

(2)Make an initd file
```
cd /boot

mkdir Test 

vim init
```
init file
```
#!/bin/bash
exec /bin/sh
```
and then change the permission of init
```
chmod 777 init 
```

(3)Copy Files of bash and sh with their dependent files
```
cp /bin/bash /bin/sh bin
```
```
ldd /bin/bash

ldd /bin/sh

cd Test

mkdir lib64
```
```
cp /lib64/libtinfo.so.5 /lib64/libdl.so.2 /lib64/libc.so.6 /lib64/ld-linux-x86-64.so.2 /lib64/libtinfo.so.5 /lib64/libdl.so.2 /lib64/libc.so.6 /lib64/ld-linux-x86-64.so.2 lib64
```

(4)package to Test.img
```
 find . | cpio -H newc -o | gzip > /boot/Test.img
```
(5)reboot and choose the my_litile_linux

## 9.Make Kernel

#### 1 problem
```
yum install  -y ncurses-devel

sudo yum install openssl-devel
```


(1)make -j4

(2)"make install" is smarter


## 10.ip change 

```
ps -eaf | grep dhc

ip route replace default via 172.16.255.2
```

## 11.set eth0 ip

Just make it as a sh file
```
insmod /lib/modules/2.6.32-358.el6.x86_64/kernel/drivers/net/e1000/
e1000.ko


ifconfig eth0 up 

ifconfig lo up 

ifconfig eth0 172.16.225.128 255.255.255.0 up
```
## 12.Check which command and file need
```
bash -x /etc/init.d/sshd    start
```
